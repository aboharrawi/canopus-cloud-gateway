services:
  app:
    image: 'canopus-cloud-gateway:0.0.1'
    container_name: canopus-cloud-gateway
    build: '.'
    ports:
      - "8081:8081"
      - "5006:5006" #exposed for debugging
    depends_on:
      - canopus-httpbin
      - canopus-keycloak
    networks:
      - canopus

  # keycloak
  canopus-keycloak:
    image: 'quay.io/keycloak/keycloak:21.1'
    container_name: canopus-keycloak
    ports:
      - "8082:8080"
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_HOSTNAME: localhost
      KC_HOSTNAME_PORT: 8080
    command:
      - start-dev
    networks:
      - canopus

  # httpbin for service testing
  canopus-httpbin:
    image: 'kennethreitz/httpbin'
    container_name: canopus-httpbin
    ports:
      - "8083:80"
    networks:
      - canopus

networks:
  canopus:
    name: canopus